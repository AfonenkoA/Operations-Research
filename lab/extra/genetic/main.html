<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.11">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>33&nbsp; Генетический алгоримт. Материализованные представления – Исследование операций</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../lab/extra/constraint/main.html" rel="next">
<link href="../../../lab/extra/evolutionary/main.html" rel="prev">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-09b140d2d032adf2aedb8b099be3ee13.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-a37c3f83d22f78a2a185819b108e8b30.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Поиск не дал результатов",
    "search-matching-documents-text": "Результаты поиска",
    "search-copy-link-title": "Скопировать ссылку",
    "search-hide-matches-text": "Скрыть дополнительные результаты",
    "search-more-match-text": "дополнительный результат в этом документе",
    "search-more-matches-text": "дополнительных результата(-ов) в этом документе",
    "search-clear-button-title": "Очистить",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Отменить",
    "search-submit-button-title": "Найти",
    "search-label": "Поиск"
  }
}</script><script src="../../../site_libs/quarto-diagram/mermaid.min.js"></script><script src="../../../site_libs/quarto-diagram/mermaid-init.js"></script><link href="../../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="/Operations-Research/site_libs/mathjax-3.2.2/tex-svg-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключить боковую панель навигации" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../lab/extra/programming/r/main.html">Задания. Дополнительно</a></li><li class="breadcrumb-item"><a href="../../../lab/extra/genetic/main.html"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Генетический алгоримт. Материализованные представления</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключить боковую панель навигации" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Поиск" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../">Исследование операций</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/AfonenkoA/Operations-Research" title="Исходный код" class="quarto-navigation-tool px-1" aria-label="Исходный код"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Поиск"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Интерактивный курс по исследованию операций</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../enviroment/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Среда разработки</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../enviroment/setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Установка и настройка</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../enviroment/rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">RStudio IDE</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../enviroment/quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../enviroment/markdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Язык разметки Markdown</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../enviroment/latex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Язык разметки LaTeX</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../r/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Язык программирования R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/lang/basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Основы R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../linear/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Линейное программирование</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../linear/algebra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Элементы линейной алгебры</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../linear/graphical/solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Графическое решение</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../linear/graphical/sensetivity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Графический анализ чувствительности</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../linear/simplex/special-cases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Особые случаи применения симплекс метода</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../linear/integer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Целочисленное программирование</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../minizinc/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Язык моделирования MiniZinc</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../minizinc/basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Основы Minizinc</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../nonlinear/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Нелинейное программирование</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../nonlinear/unconstrained/analytical/one/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Безусловная оптимизация функции одной переменной</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../nonlinear/unconstrained/analytical/many/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Безусловная оптимизация функции многих переменных</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../nonlinear/constrained/analytical/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Условная оптимизация функции многих переменных</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../nonlinear/constrained/numerical/conversion-to-unconstrained.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Сведение к задаче неограниченной оптимизации</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../evolutionary/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Эволюционная оптимизация</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../evolutionary/stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Статистика анализ</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Задания. Алгоритмы</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/alghorithm/programming/r/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/alghorithm/linear/algebra/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Линейная алгебра</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/alghorithm/nonlinear/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Нелинейное программирование</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/alghorithm/evolutionary/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Эволюционная оптимизация</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Задания. Моделирование</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/model/basic/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Введение</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/model/linear/standard/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Линейное программирование</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/model/linear/transport/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Транспортные модели</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/model/linear/integer/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Целочисленное линейное программирование</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/model/network/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Сетевые модели</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/model/nonlinear/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Нелинейная оптимизация</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/model/evolutionary/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Эволюционная оптимизация</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Задания. Дополнительно</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/extra/programming/r/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/extra/network/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Cетевые модели</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/extra/nonlinear/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Нелинейная оптимизация. Последние минуты жизни</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/extra/evolutionary/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Эволюционная оптимизация. Телекомания</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/extra/genetic/main.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Генетический алгоримт. Материализованные представления</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lab/extra/constraint/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Программирование в ограничениях</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Практические работы</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../practice/basic-model/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Модели исследования операций</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../practice/linear/algebra/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Линейная алгебра</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../practice/linear/graphical/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Линейное программирование. Графическое представление</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../practice/linear/model/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Линейное программирование. Модели</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../practice/linear/simplex/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Линейное программирование. Симплекс метод</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Литература</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true">
 <span class="menu-text">Приложения</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false">
 <span class="menu-text">Язык программирования R</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/renv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Система управления пакетами renv</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/pracma.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Численные методы <code>pracma</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/smoof.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Smoof</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Пакет <code>stats</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/plot/plotly.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Графическая библиотека plotly</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/solver/linear/transport.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Решатель transport</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/solver/linear/lpsolve.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Решатель LPSolve</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/solver/linear/clue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Решатель Clue</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/solver/nonlinear/nloptr/analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Nloptr. Анализ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/solver/nonlinear/nloptr/local/unconstrained.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Nloptr. Локальная безуслованя</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/solver/nonlinear/nloptr/local/constrained/inequality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Nloptr. Локальная. Ограничения неравенства</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/solver/nonlinear/nloptr/local/constrained/equality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Nloptr. Локальная. Ограничения равенства</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/solver/evolutionary/analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">M</span>&nbsp; <span class="chapter-title">Анализ эволюционного алгоритма</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/solver/evolutionary/gensa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">N</span>&nbsp; <span class="chapter-title">GenSA Имитации отжига</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/solver/evolutionary/pso.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">O</span>&nbsp; <span class="chapter-title">PSO метод роя частиц</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/solver/evolutionary/ga.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">P</span>&nbsp; <span class="chapter-title">GA обобщенный генетический алгоритм</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../r/tools/solver/evolutionary/tsp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">Q</span>&nbsp; <span class="chapter-title">TSP задача коммивояжера</span></span></a>
  </div>
</li>
      </ul>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Содержание</h2>
   
  <ul>
<li><a href="#sec-lab-extra-genetic-materialized-view-local-query" id="toc-sec-lab-extra-genetic-materialized-view-local-query" class="nav-link active" data-scroll-target="#sec-lab-extra-genetic-materialized-view-local-query"><span class="header-section-number">33.1</span> Локальная оптимизация запроса</a></li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-global-query" id="toc-sec-lab-extra-genetic-materialized-view-global-query" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-global-query"><span class="header-section-number">33.2</span> Глобальная оптимизация нескольких запросов</a></li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-selection" id="toc-sec-lab-extra-genetic-materialized-view-selection" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-selection"><span class="header-section-number">33.3</span> Выбор материализованных представления</a></li>
  <li>
<a href="#sec-lab-extra-genetic-materialized-view-query-model-plan" id="toc-sec-lab-extra-genetic-materialized-view-query-model-plan" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-query-model-plan"><span class="header-section-number">33.4</span> Модель запроса</a>
  <ul class="collapse">
<li><a href="#sec-lab-extra-genetic-materialized-view-query-model-plan-join" id="toc-sec-lab-extra-genetic-materialized-view-query-model-plan-join" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-query-model-plan-join"><span class="header-section-number">33.4.1</span> JOIN</a></li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-query-model-plan-where" id="toc-sec-lab-extra-genetic-materialized-view-query-model-plan-where" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-query-model-plan-where"><span class="header-section-number">33.4.2</span> WHERE</a></li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-query-model-plan-select" id="toc-sec-lab-extra-genetic-materialized-view-query-model-plan-select" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-query-model-plan-select"><span class="header-section-number">33.4.3</span> SELECT</a></li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-query-model-plan-aggregate" id="toc-sec-lab-extra-genetic-materialized-view-query-model-plan-aggregate" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-query-model-plan-aggregate"><span class="header-section-number">33.4.4</span> AGGREGATE</a></li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-query-model-plan-full" id="toc-sec-lab-extra-genetic-materialized-view-query-model-plan-full" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-query-model-plan-full"><span class="header-section-number">33.4.5</span> Полный граф вычислений</a></li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-query-model-plan-yaml" id="toc-sec-lab-extra-genetic-materialized-view-query-model-plan-yaml" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-query-model-plan-yaml"><span class="header-section-number">33.4.6</span> Представление в yaml</a></li>
  </ul>
</li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-maintain-cost" id="toc-sec-lab-extra-genetic-materialized-view-maintain-cost" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-maintain-cost"><span class="header-section-number">33.5</span> Стоимость обслуживания</a></li>
  <li>
<a href="#sec-lab-extra-genetic-materialized-view-query-cost" id="toc-sec-lab-extra-genetic-materialized-view-query-cost" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-query-cost"><span class="header-section-number">33.6</span> Стоимость вычисления запроса</a>
  <ul class="collapse">
<li><a href="#sec-lab-extra-genetic-materialized-view-query-cost-join" id="toc-sec-lab-extra-genetic-materialized-view-query-cost-join" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-query-cost-join"><span class="header-section-number">33.6.1</span> JOIN</a></li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-query-cost-where" id="toc-sec-lab-extra-genetic-materialized-view-query-cost-where" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-query-cost-where"><span class="header-section-number">33.6.2</span> WHERE</a></li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-query-cost-select" id="toc-sec-lab-extra-genetic-materialized-view-query-cost-select" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-query-cost-select"><span class="header-section-number">33.6.3</span> SELECT</a></li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-query-cost-aggregate" id="toc-sec-lab-extra-genetic-materialized-view-query-cost-aggregate" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-query-cost-aggregate"><span class="header-section-number">33.6.4</span> AGGREGATE</a></li>
  </ul>
</li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-objective" id="toc-sec-lab-extra-genetic-materialized-view-objective" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-objective"><span class="header-section-number">33.7</span> Целевая функция</a></li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-global-plan" id="toc-sec-lab-extra-genetic-materialized-view-global-plan" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-global-plan"><span class="header-section-number">33.8</span> Построение глобального плана запросов</a></li>
  <li><a href="#sec-lab-extra-genetic-materialized-view-genetic-alghorithm" id="toc-sec-lab-extra-genetic-materialized-view-genetic-alghorithm" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-genetic-alghorithm"><span class="header-section-number">33.9</span> Решение генетическим алгоритмом</a></li>
  <li>
<a href="#sec-lab-extra-genetic-materialized-view-igraph-query" id="toc-sec-lab-extra-genetic-materialized-view-igraph-query" class="nav-link" data-scroll-target="#sec-lab-extra-genetic-materialized-view-igraph-query"><span class="header-section-number">33.10</span> Запросы к графу</a>
  <ul class="collapse">
<li><a href="#%D0%B2%D1%8B%D0%B1%D0%BE%D1%80-%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%B0" id="toc-выбор-поддерева" class="nav-link" data-scroll-target="#%D0%B2%D1%8B%D0%B1%D0%BE%D1%80-%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%B0"><span class="header-section-number">33.10.1</span> Выбор поддерева</a></li>
  <li><a href="#%D0%B2%D1%8B%D0%B1%D0%BE%D1%80-%D0%B2%D0%B5%D1%80%D1%88%D0%B8%D0%BD" id="toc-выбор-вершин" class="nav-link" data-scroll-target="#%D0%B2%D1%8B%D0%B1%D0%BE%D1%80-%D0%B2%D0%B5%D1%80%D1%88%D0%B8%D0%BD"><span class="header-section-number">33.10.2</span> Выбор вершин</a></li>
  <li><a href="#%D1%81%D1%82%D0%B5%D0%BF%D0%B5%D0%BD%D1%8C-%D0%B2%D0%B5%D1%80%D1%88%D0%B8%D0%BD%D1%8B" id="toc-степень-вершины" class="nav-link" data-scroll-target="#%D1%81%D1%82%D0%B5%D0%BF%D0%B5%D0%BD%D1%8C-%D0%B2%D0%B5%D1%80%D1%88%D0%B8%D0%BD%D1%8B"><span class="header-section-number">33.10.3</span> Степень вершины</a></li>
  <li><a href="#%D0%B2%D1%8B%D0%B1%D0%BE%D1%80-%D1%80%D1%91%D0%B1%D0%B5%D1%80" id="toc-выбор-рёбер" class="nav-link" data-scroll-target="#%D0%B2%D1%8B%D0%B1%D0%BE%D1%80-%D1%80%D1%91%D0%B1%D0%B5%D1%80"><span class="header-section-number">33.10.4</span> Выбор рёбер</a></li>
  <li><a href="#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2%D0%B5%D1%80%D1%88%D0%B8%D0%BD-%D1%81%D0%BC%D0%B5%D0%B6%D0%BD%D1%8B%D1%85-%D1%80%D0%B5%D0%B1%D1%80%D1%83" id="toc-получение-вершин-смежных-ребру" class="nav-link" data-scroll-target="#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2%D0%B5%D1%80%D1%88%D0%B8%D0%BD-%D1%81%D0%BC%D0%B5%D0%B6%D0%BD%D1%8B%D1%85-%D1%80%D0%B5%D0%B1%D1%80%D1%83"><span class="header-section-number">33.10.5</span> Получение вершин смежных ребру</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/AfonenkoA/Operations-Research/issues/new" class="toc-action"><i class="bi bi-github"></i>Сообщить о проблеме</a></li><li><a href="https://github.com/AfonenkoA/Operations-Research/blob/master/lab/extra/genetic/main.qmd" class="toc-action"><i class="bi empty"></i>Показать код</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../lab/extra/programming/r/main.html">Задания. Дополнительно</a></li><li class="breadcrumb-item"><a href="../../../lab/extra/genetic/main.html"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Генетический алгоримт. Материализованные представления</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-lab-extra-genetic-materialized-view" class="quarto-section-identifier"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Генетический алгоримт. Материализованные представления</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>Хранилище данных (data warehousing) — это подход к интеграции данных из множества, возможно, очень больших, распределённых и неоднородных баз данных и других источников информации. Хранилище данных (DW) представляет собой репозиторий (хранилище) интегрированной информации, доступной для запросов и анализа. Чтобы избежать обращения к исходным источникам данных и повысить эффективность выполнения запросов к DW, некоторые промежуточные результаты обработки запросов сохраняются в самом хранилище. Эти промежуточные результаты называются материализованными представлениями (materialized views). На достаточно абстрактном уровне хранилище данных можно рассматривать как набор материализованных представлений над данными, извлечёнными из распределённых неоднородных баз данных. Существует множество исследовательских задач, связанных с DW, среди которых одной из самых сложных является задача выбора материализованных представлений. С одной стороны, материализованные представления ускоряют обработку запросов. С другой – они требуют обновления при изменениях в источниках данных. Следовательно, при выборе материализованных представлений необходимо учитывать две категории затрат: затраты на обработку запросов и затраты на обслуживание (обновление) материализованных представлений. Нас интересует следующий вопрос: какие представления следует материализовать, чтобы сумма затрат на выполнение запросов и обслуживание представлений была минимальной?</p>
<p>Выбор материализованных представлений представляет собой сложный компромисс между производительностью выполнения запросов и затратами на обслуживание.</p>
<ul>
<li>Материализация всех представлений в хранилище данных (DW) обеспечивает наилучшую производительность, но сопровождается наивысшими затратами на обслуживание представлений.</li>
<li>Оставление всех представлений виртуальными приведёт к минимальным затратам на их обслуживание, но к худшей производительности запросов. Под “виртуальными” в данном контексте подразумевается, что никакие промежуточные результаты не сохраняются в хранилище данных.</li>
<li>Возможен также смешанный подход, при котором часть представлений материализуется (например, те, которые используются совместно), а остальные остаются виртуальными. Таким образом можно достичь оптимального (или близкого к оптимальному) баланса между приростом производительности и затратами на обслуживание.</li>
</ul>
<p>К сожалению, доказано, что задача проектирования выбора материализованных представлений является NP-трудных. Поэтому на практике приходится использовать эвристику для нахождения приближённого к оптимальному решения. Задача, рассматриваемая в далее, формулируется следующим образом: на основе множества часто используемых запросов к хранилищу данных (DW) необходимо выбрать набор представлений для материализации таким образом, чтобы суммарные затраты на выполнение запросов и обслуживание были минимальны. Рассматриваемая задача связана с тремя различными аспектами:</p>
<ol type="1">
<li>Оптимизации выполнения одного запроса <a href="#sec-lab-extra-genetic-materialized-view-local-query" class="quarto-xref"><span>Глава 33.1</span></a>
</li>
<li>Оптимизация нескольких запросов одновременно <a href="#sec-lab-extra-genetic-materialized-view-global-query" class="quarto-xref"><span>Глава 33.2</span></a>
</li>
<li>Выбор материализованных представлений <a href="#sec-lab-extra-genetic-materialized-view-selection" class="quarto-xref"><span>Глава 33.3</span></a>
</li>
</ol>
<p>Следует отметить, что набор локально оптимизированных запросов может перестать быть оптимальным при совместном рассмотрении нескольких запросов. Аналогично, оптимальный набор множества запросов не гарантирует оптимальный выбор материализованных представлений, так как другой набор может привести к более эффективным материализованным представлениям. Поэтому важно рассматривать все три задачи, которые являются NP полными, вместе при выборе материализованных представлений. Однако в учебных целях будет <strong>исследоваться только</strong> решение задачи выбора материализованных представлений.</p>
<section id="sec-lab-extra-genetic-materialized-view-local-query" class="level2" data-number="33.1"><h2 data-number="33.1" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-local-query">
<span class="header-section-number">33.1</span> Локальная оптимизация запроса</h2>
<p>Пусть есть три таблицы со следующей схемой</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"></figure><p></p>
<div>
<pre class="mermaid mermaid-js">erDiagram
    catergories ||--|{ product : has
    manufacturers ||--|{ product : has
    catergories {
        int id
        text name
    }

    manufacturers {
        int id
        text name
        text country
    }
    product {
        int id
        int category_id
        int manufacturer_id
        text name
    }
</pre>
</div>
<p></p>
</div>
</div>
</div>
<p>и запрос на выборку из всех трёх таблиц</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> product</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> catergories <span class="kw">ON</span> product.category_id <span class="op">=</span> catergories.<span class="kw">id</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> manufacturers <span class="kw">ON</span> product.manufacturer_id <span class="op">=</span> manufacturers.<span class="kw">id</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>В оптимизации запросов одной из самых затратных операций является операция соединения (JOIN). Оптимизация оптимизация запроса здесь будет пониматься как оптимизация порядка соединений</p>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="main_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="main_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<p>Локальный план обработки определяется как граф запроса, в котором все отношения — это листовые узлы, а все операции (например, соединение, проекция и выборка) — внутренние узлы. Поскольку рассматривается только операция соединения, локальный план обработки для запроса можно представить в виде бинарного дерева соединений, листьями которого являются все отношения, а внутренними узлами — операции соединения. Рёбра в таком дереве маркируются предикатами соединения и селективностью соединения. Предикат соединения сопоставляет кортежи из декартова произведения смежных узлов в значение <em>false</em> или <em>true</em> в зависимости от того, должен ли кортеж включаться в результат. Селективность соединения — это отношение количества включенных кортежей к общему количеству кортежей.</p>
<p>Стоимости двух деревьев соединения также различаются, хотя структура одинаковая, потому что порядок соединения отношений разный. Левое дерево в имеет вид <span class="math inline">\(((cat \bowtie prod) \bowtie man)\)</span>, когда правое дерево – <span class="math inline">\(((cat \bowtie man) \bowtie prod)\)</span>. Предположим, что размеры таблиц <span class="math inline">\(cat\)</span>, <span class="math inline">\(man\)</span> и <span class="math inline">\(prod\)</span> равны 20, 30 и 100 соответственно. Стоимость левого дерева рассчитывается следующим образом. Сначала вычисляется стоимость <span class="math inline">\((cat \bowtie prod)\)</span> как <span class="math inline">\(\|cat\| \cdot \|prod\|=20 \cdot 100=2000\)</span>. Если результаты <span class="math inline">\((cat \bowtie prod)\)</span> содержим 50 кортежей, то стоимость <span class="math inline">\(((cat \bowtie prod) \bowtie man)\)</span> будет <span class="math inline">\(50 \cdot 30=1500\)</span>. Итак, общая стоимость: <span class="math inline">\(2000+1500=3500\)</span>. Однако, стоимость правого дерева в будет отличаться. Стоимость <span class="math inline">\((cat \bowtie man)\)</span> равна <span class="math inline">\(\|cat\| \cdot \|man\|=20 \cdot 30=600\)</span>. Если результат <span class="math inline">\((cat \bowtie man)\)</span> содержит 30 кортежей, то стоимость <span class="math inline">\(((cat \bowtie man) \bowtie prod)\)</span> будет равна <span class="math inline">\(30 \cdot 100=3000\)</span>, и, следовательно общая стоимость равна <span class="math inline">\(600 + 3000 = 3500\)</span>.</p>
<p>Таким образом для определения оптимального локального плана выполнения запроса требуется решить. NP полную задачу. Данная задача далее рассматриваться <strong>не будет</strong> в связи с подходом к построению глобального плана указанного в пункте <a href="#sec-lab-extra-genetic-materialized-view-global-plan" class="quarto-xref"><span>Глава 33.8</span></a>.</p>
</section><section id="sec-lab-extra-genetic-materialized-view-global-query" class="level2" data-number="33.2"><h2 data-number="33.2" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-global-query">
<span class="header-section-number">33.2</span> Глобальная оптимизация нескольких запросов</h2>
<p>Дано множество планов обработки для запроса. Цель оптимизации запроса — найти такой план обработки, который обеспечивает наименьшую стоимость выполнения запроса. Глобальный план выполнения получается путём объединения локальных планов. Таким образом два запроса могут быть объединены по общим узлам. Рассмотрим следующие 3 запроса которые попарно используют 4 таблицы (T1, T2, T3, T4)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> T1 <span class="kw">JOIN</span> T2, T3</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> T1 <span class="kw">JOIN</span> T2, T4</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> T2 <span class="kw">JOIN</span> T3, T4</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Их локальные планы выполнения</p>
<div class="cell quarto-layout-panel" data-layout-ncol="3">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="main_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="main_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="main_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<p>При объединении нескольких планов обработки запросов, то есть нескольких деревьев соединений, формируемый глобальный план обработки должен представлять собой ориентированный ациклический граф (DAG), а не дерево. Вершины <code>Q1</code>, <code>Q2</code> и <code>Q3</code> обозначают результирующие таблицы запросов.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="main_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>При объединении в один глобальный план возникает несколько вариантов промежуточных объединений, например JOIN(T1,T2) или JOIN(T2,T3). В общем случае объединение локально оптимальных планов не обязательно приводит к глобально оптимальному плану. Следовательно, мы не можем найти глобально оптимальный план, просто объединив локально оптимальные планы. Выбор оптимального глобального плана так-же является NP полной задачей и рассматриваться <strong>не будет</strong> в связи с подходом к построению глобального плана указанного в пункте <a href="#sec-lab-extra-genetic-materialized-view-global-plan" class="quarto-xref"><span>Глава 33.8</span></a>.</p>
</section><section id="sec-lab-extra-genetic-materialized-view-selection" class="level2" data-number="33.3"><h2 data-number="33.3" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-selection">
<span class="header-section-number">33.3</span> Выбор материализованных представления</h2>
<p>Основная задача – это выбор представлений для материализации таким образом, чтобы минимизировать стоимость обработки запросов и поддержки представлений для всех узлов в глобальном плане обработки. Простой подход — использовать полный перебор, чтобы найти оптимальный набор материализованных представлений для заданного множества запросов. Однако этот подход становится непрактичным при большом пространстве поиска. Задача выбора материализованных представлений является NP-трудной. Для ускорения получения результата необходимо использовать эволюционные алгоритмы, чтобы сократить пространство поиска <a href="#sec-lab-extra-genetic-materialized-view-genetic-alghorithm" class="quarto-xref"><span>Глава 33.9</span></a>. Для предварительного сокращения пространства поиска имеет смысл материализовать только <strong>совсместно используемые</strong> промежуточные узлы.</p>
</section><section id="sec-lab-extra-genetic-materialized-view-query-model-plan" class="level2" data-number="33.4"><h2 data-number="33.4" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-query-model-plan">
<span class="header-section-number">33.4</span> Модель запроса</h2>
<p>Рассмотрим запрос выборки на языке SQL: “Товары дороже средней цены”</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> products.name, price_change.price</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> products</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> price_change <span class="kw">ON</span> products.<span class="kw">id</span> <span class="op">=</span> price_change.product_id</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> price_change.price <span class="op">&gt;</span> (<span class="kw">SELECT</span> <span class="fu">AVG</span>(price_change.price) <span class="kw">FROM</span> price_change)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>из таблиц</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"></figure><p></p>
<div>
<pre class="mermaid mermaid-js">erDiagram
    products ||--|{ price_change : has
    
    price_change {
        int id
        int product_id
        real price
        date change_date
    }
    products {
        int id
        int category_id
        int manufacturer_id
        text name
        real price
    }
</pre>
</div>
<p></p>
</div>
</div>
</div>
<p>Разделим его на подзапрос, вычисляющий среднюю цену <code>average_price</code></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(price_change.price)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> price_change</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>и главный запрос</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> products.name, price_change.price</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> products</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> price_change <span class="kw">ON</span> products.<span class="kw">id</span> <span class="op">=</span> price_change.product_id</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> price_change.price <span class="op">&gt;</span> average_price</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>В задаче будет рассматриваться максимально упрощенное подмножество операторов языка SQL. Рассмотрим, как предстваить этот запрос в виде графа вычислений.</p>
<p>С каждым вычислительным узлом связана таблица, эта таблица передаётся в главном аргументе (связь <code>val</code>)</p>
<section id="sec-lab-extra-genetic-materialized-view-query-model-plan-join" class="level3" data-number="33.4.1"><h3 data-number="33.4.1" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-query-model-plan-join">
<span class="header-section-number">33.4.1</span> JOIN</h3>
<p>Рассмотрим часть запроса</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> products</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> price_change <span class="kw">ON</span> products.<span class="kw">id</span> <span class="op">=</span> price_change.product_id</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Представленную в yaml</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span><span class="kw">:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">join</span><span class="kw">:</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> products</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> price_change</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Операция JOIN выполняется в два этапа, сначала создаётся полное декартово произведение двух таблиц, далее записи фильтруются по условию соединения в операции WHERE <a href="#sec-lab-extra-genetic-materialized-view-query-model-plan-where" class="quarto-xref"><span>Глава 33.4.2</span></a>. У операции JOIN аргументы (таблицы) равнозначны, что отличает её от других функций, которые имеют один главный аргумент (<code>val</code>), к которому они применяют другие свои аргументы <code>arg</code>. Для однотипной обработки введём фиктивный главный аргумент <code>JOIN EMPTY</code> — <code>JE</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="main_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>На текущий момент граф выглядит следующим образом:</p>
<div class="cell" data-tbl-cap="[&quot;Вершины&quot;,&quot;Рёбра&quot;]">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Вершины</caption>
<thead><tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">fun</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">JE</td>
<td style="text-align: left;">table</td>
</tr>
<tr class="even">
<td style="text-align: left;">products</td>
<td style="text-align: left;">table</td>
</tr>
<tr class="odd">
<td style="text-align: left;">price_change</td>
<td style="text-align: left;">table</td>
</tr>
<tr class="even">
<td style="text-align: left;">JOIN(JE,products,price_change)</td>
<td style="text-align: left;">JOIN</td>
</tr>
<tr class="odd">
<td style="text-align: left;">QJ</td>
<td style="text-align: left;">query</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Рёбра</caption>
<thead><tr class="header">
<th style="text-align: left;">from</th>
<th style="text-align: left;">to</th>
<th style="text-align: left;">label</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">products</td>
<td style="text-align: left;">JOIN(JE,products,price_change)</td>
<td style="text-align: left;">arg</td>
</tr>
<tr class="even">
<td style="text-align: left;">price_change</td>
<td style="text-align: left;">JOIN(JE,products,price_change)</td>
<td style="text-align: left;">arg</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JE</td>
<td style="text-align: left;">JOIN(JE,products,price_change)</td>
<td style="text-align: left;">val</td>
</tr>
<tr class="even">
<td style="text-align: left;">JOIN(JE,products,price_change)</td>
<td style="text-align: left;">QJ</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Соответственно на данный момент результатом операции будет таблица, состоящая из <span class="math inline">\(100 \cdot 150 = 15000\)</span> строк и следующих столбцов</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">col</th>
<th style="text-align: left;">type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">products.id</td>
<td style="text-align: left;">INTEGER</td>
</tr>
<tr class="even">
<td style="text-align: left;">products.name</td>
<td style="text-align: left;">TEXT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">products.category_id</td>
<td style="text-align: left;">INTEGER</td>
</tr>
<tr class="even">
<td style="text-align: left;">products.manufacturer_id</td>
<td style="text-align: left;">INTEGER</td>
</tr>
<tr class="odd">
<td style="text-align: left;">products.price</td>
<td style="text-align: left;">REAL</td>
</tr>
<tr class="even">
<td style="text-align: left;">price_change.id</td>
<td style="text-align: left;">INTEGER</td>
</tr>
<tr class="odd">
<td style="text-align: left;">price_change.product_id</td>
<td style="text-align: left;">INTEGER</td>
</tr>
<tr class="even">
<td style="text-align: left;">price_change.price</td>
<td style="text-align: left;">REAL</td>
</tr>
<tr class="odd">
<td style="text-align: left;">price_change.change_date</td>
<td style="text-align: left;">DATE</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Уведомление
</div>
</div>
<div class="callout-body-container callout-body">
<p>Считается, что у таблицы JoinEmpty (JE) нет столбцов и одна строка.</p>
</div>
</div>
</section><section id="sec-lab-extra-genetic-materialized-view-query-model-plan-where" class="level3" data-number="33.4.2"><h3 data-number="33.4.2" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-query-model-plan-where">
<span class="header-section-number">33.4.2</span> WHERE</h3>
<p>Добавим к запросу условие отбора, его главынм аргументом <code>val</code> будет таблица, полученная на предыдущем шаге в JOIN, а аргументами <code>arg</code> имена условий</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> price_change.new_price <span class="op">&gt;</span> average_price <span class="kw">AND</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  products.<span class="kw">id</span> <span class="op">=</span> price_change.product_id</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Представленную в yaml</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span><span class="kw">:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">where</span><span class="kw">:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> products.id = price_change.product_id</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">sample</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.3</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> price_change.new_price &gt; average_price</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">sample</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.3</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">depends</span><span class="kw">:</span><span class="at"> average_price</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="main_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Заметим, что условие <code>price_change.new_price &gt; average_price</code> зависит от подзапроса <code>average_price</code>, поэтому и назовём его так-же для удобства.</p>
<p>В граф были добавлены</p>
<div class="cell" data-tbl-cap="[&quot;Вершины&quot;,&quot;Рёбра&quot;]">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Вершины</caption>
<colgroup>
<col style="width: 90%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">fun</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">products.id = price_change.product_id</td>
<td style="text-align: left;">condition</td>
</tr>
<tr class="even">
<td style="text-align: left;">average_price</td>
<td style="text-align: left;">condition</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WHERE(JOIN(JE,products,price_change),products.id = price_change.product_id,average_price)</td>
<td style="text-align: left;">WHERE</td>
</tr>
<tr class="even">
<td style="text-align: left;">QW</td>
<td style="text-align: left;">query</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Рёбра</caption>
<colgroup>
<col style="width: 48%">
<col style="width: 48%">
<col style="width: 3%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">from</th>
<th style="text-align: left;">to</th>
<th style="text-align: left;">label</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">products.id = price_change.product_id</td>
<td style="text-align: left;">WHERE(JOIN(JE,products,price_change),products.id = price_change.product_id,average_price)</td>
<td style="text-align: left;">arg</td>
</tr>
<tr class="even">
<td style="text-align: left;">average_price</td>
<td style="text-align: left;">WHERE(JOIN(JE,products,price_change),products.id = price_change.product_id,average_price)</td>
<td style="text-align: left;">arg</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JOIN(JE,products,price_change)</td>
<td style="text-align: left;">WHERE(JOIN(JE,products,price_change),products.id = price_change.product_id,average_price)</td>
<td style="text-align: left;">val</td>
</tr>
<tr class="even">
<td style="text-align: left;">WHERE(JOIN(JE,products,price_change),products.id = price_change.product_id,average_price)</td>
<td style="text-align: left;">QW</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Так как оба условия имеют селективность <span class="math inline">\(0.3\)</span>, то общее число строк станет <span class="math inline">\(15000 \cdot {0.3}^2=1350\)</span>, а столбцы останутся всё те же.</p>
</section><section id="sec-lab-extra-genetic-materialized-view-query-model-plan-select" class="level3" data-number="33.4.3"><h3 data-number="33.4.3" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-query-model-plan-select">
<span class="header-section-number">33.4.3</span> SELECT</h3>
<p>Главным аргументом запроса <code>val</code> будет таблица полученная на предыдущем шаге, а аргументами <code>arg</code> будут полные названия столбцов</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> products.product_name, price_change.new_price</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Представленную в yaml</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span><span class="kw">:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">select</span><span class="kw">:</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> products.product_name</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> price_change.new_price</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="main_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>В граф были добавлены</p>
<div class="cell" data-tbl-cap="[&quot;Вершины&quot;,&quot;Рёбра&quot;]">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Вершины</caption>
<colgroup>
<col style="width: 94%">
<col style="width: 5%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">fun</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">products.name</td>
<td style="text-align: left;">column</td>
</tr>
<tr class="even">
<td style="text-align: left;">price_change.price</td>
<td style="text-align: left;">column</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SELECT(WHERE(JOIN(JE,products,price_change),products.id = price_change.product_id,average_price),products.name,price_change.price)</td>
<td style="text-align: left;">SELECT</td>
</tr>
<tr class="even">
<td style="text-align: left;">QS</td>
<td style="text-align: left;">query</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Рёбра</caption>
<colgroup>
<col style="width: 48%">
<col style="width: 48%">
<col style="width: 2%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">from</th>
<th style="text-align: left;">to</th>
<th style="text-align: left;">label</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">products.name</td>
<td style="text-align: left;">SELECT(WHERE(JOIN(JE,products,price_change),products.id = price_change.product_id,average_price),products.name,price_change.price)</td>
<td style="text-align: left;">arg</td>
</tr>
<tr class="even">
<td style="text-align: left;">price_change.price</td>
<td style="text-align: left;">SELECT(WHERE(JOIN(JE,products,price_change),products.id = price_change.product_id,average_price),products.name,price_change.price)</td>
<td style="text-align: left;">arg</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WHERE(JOIN(JE,products,price_change),products.id = price_change.product_id,average_price)</td>
<td style="text-align: left;">SELECT(WHERE(JOIN(JE,products,price_change),products.id = price_change.product_id,average_price),products.name,price_change.price)</td>
<td style="text-align: left;">val</td>
</tr>
<tr class="even">
<td style="text-align: left;">SELECT(WHERE(JOIN(JE,products,price_change),products.id = price_change.product_id,average_price),products.name,price_change.price)</td>
<td style="text-align: left;">QS</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>В этом случае в таблице останутся только два столбца</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">col</th>
<th style="text-align: left;">type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">products.name</td>
<td style="text-align: left;">TEXT</td>
</tr>
<tr class="even">
<td style="text-align: left;">price_change.price</td>
<td style="text-align: left;">REAL</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="sec-lab-extra-genetic-materialized-view-query-model-plan-aggregate" class="level3" data-number="33.4.4"><h3 data-number="33.4.4" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-query-model-plan-aggregate">
<span class="header-section-number">33.4.4</span> AGGREGATE</h3>
<p>Возможны следующие функции агрегации</p>
<ul>
<li>IDENTITY</li>
<li>COUNT</li>
<li>SUM</li>
<li>MAX</li>
<li>AVG</li>
<li>MIN</li>
<li>DISTINCT</li>
</ul>
<p>Оператор IDENTITY введён для обобщенной обработки и не изменяет текущий столбец. Продемонстрируем применение функции агрегации на подзапросе.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(price_change.price_change)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> price_change</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subqueries</span><span class="kw">:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">body</span><span class="kw">:</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">from</span><span class="kw">:</span><span class="at"> price_change</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">select</span><span class="kw">:</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> price_change.new_price</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">aggregate</span><span class="kw">:</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> AVG</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="main_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="sec-lab-extra-genetic-materialized-view-query-model-plan-full" class="level3" data-number="33.4.5"><h3 data-number="33.4.5" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-query-model-plan-full">
<span class="header-section-number">33.4.5</span> Полный граф вычислений</h3>
<p>Объединив главный запрос и подзапрос получаем следующий граф вычислений. Узел обозначающий запрос определяется по имени из yaml файла</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">queries</span><span class="kw">:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> products_above_avg_price</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="main_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="sec-lab-extra-genetic-materialized-view-query-model-plan-yaml" class="level3" data-number="33.4.6"><h3 data-number="33.4.6" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-query-model-plan-yaml">
<span class="header-section-number">33.4.6</span> Представление в yaml</h3>
<p>Структура таблиц определена в файле <code>database.yaml</code></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> products</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">lines</span><span class="kw">:</span><span class="at"> </span><span class="dv">100</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">freq</span><span class="kw">:</span><span class="at"> </span><span class="dv">8</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">columns</span><span class="kw">:</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> id</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> INTEGER</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> name</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> TEXT</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> category_id</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> INTEGER</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> manufacturer_id</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> INTEGER</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> price</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> REAL</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> price_change</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">lines</span><span class="kw">:</span><span class="at"> </span><span class="dv">150</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">freq</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">columns</span><span class="kw">:</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> id</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> INTEGER</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> product_id</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> INTEGER</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> price</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> REAL</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> change_date</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> DATE</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>А рассмотренный запрос сохраняется в виде yaml в файлу <code>queries.yaml</code></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">queries</span><span class="kw">:</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> Товары дороже средней цены</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> products_above_avg_price</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">freq</span><span class="kw">:</span><span class="at"> </span><span class="dv">9</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">body</span><span class="kw">:</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">join</span><span class="kw">:</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> products</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> price_change</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">where</span><span class="kw">:</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> products.id = price_change.product_id</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">sample</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.4</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> price_change.price &gt; average_price</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">sample</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.3</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">depends</span><span class="kw">:</span><span class="at"> average_price</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">select</span><span class="kw">:</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> products.name</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> price_change.price</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="fu">subqueries</span><span class="kw">:</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> Вычисление средней цены</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> average_price</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">body</span><span class="kw">:</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">from</span><span class="kw">:</span><span class="at"> price_change</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">select</span><span class="kw">:</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> price_change.price</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">aggregate</span><span class="kw">:</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> AVG</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>⤓ <a href="database.yaml">database.yaml</a></p>
<p>⤓ <a href="queries.yaml">queries.yaml</a></p>
</div>
</div>
</div>
</section></section><section id="sec-lab-extra-genetic-materialized-view-maintain-cost" class="level2" data-number="33.5"><h2 data-number="33.5" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-maintain-cost">
<span class="header-section-number">33.5</span> Стоимость обслуживания</h2>
<p>Каждый промежуточных узел характеризуется стоимость обслуживания, которая складывается из стоимости хранения <span class="math inline">\(\mathrm{store}\)</span> и стоимости обновления <span class="math inline">\(\mathrm{maint}\)</span></p>
<p><span class="math display">\[
\mathrm{main} = \mathrm{store} \cdot \mathrm{maint}
\]</span></p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">type</th>
<th style="text-align: right;">size</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">INTEGER</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">REAL</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DATE</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">TEXT</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Стоимость хранения зависит от размера таблицы</p>
<p><span class="math display">\[
\mathrm{store} = n \cdot \sum s_{col,i}
\]</span></p>
<p>где <span class="math inline">\(n\)</span> число строк в промежуточной таблице, <span class="math inline">\(s_{col,i}\)</span> – размер типа данных <span class="math inline">\(i\)</span>-того столбца.</p>
<p>Для промежуточных узлов вычислений, рассмотренных выше, стоимость приведена в таблице</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">fun</th>
<th style="text-align: right;">num_col</th>
<th style="text-align: right;">size</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">JOIN</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2100000</td>
</tr>
<tr class="even">
<td style="text-align: left;">WHERE</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">189000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SELECT</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">145800</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Стоимость обновления зависит от частоты запросов к базовым таблицам материализованного представления</p>
<p><span class="math display">\[
\mathrm{upd} = \mathrm{size} \cdot \sum f_{u,i}
\]</span></p>
<p>где <span class="math inline">\(f_i\)</span> – частота запросов <span class="math inline">\(i\)</span>-той базовой таблице этого представления. Частота запросов <span class="math inline">\(f_u\)</span> выражается параметром <code>freq</code> файла <code>database.yaml</code>.</p>
</section><section id="sec-lab-extra-genetic-materialized-view-query-cost" class="level2" data-number="33.6"><h2 data-number="33.6" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-query-cost">
<span class="header-section-number">33.6</span> Стоимость вычисления запроса</h2>
<p>Все узлы имеют свою стоимость вычисления <span class="math inline">\(\mathrm{comp}\)</span>. Если узел является листом (таблица, независимое условие, столбец), то стоимость его вычисления равна нулю. Стоимость вычисления запроса определяется стоимостью вычисления его узлов <strong>поиском в глубину</strong>. Для сокращения вычислительных затрат в качестве кандидатов на материализацию будут рассматриваться только совместно используемые промежуточные узлы. Если узел выбран как материализованный, то стоимость его вычисления учитывается <strong>только один раз</strong> в общей стоимости вычисления всех запросов.</p>
<p>Итоговая стоимость вычисления запроса также зависит от его частоты <span class="math inline">\(f_{q}\)</span>, которая приведена в файле <code>queries.yaml</code> параметром <code>freq</code></p>
<p>Стоимости вычисления функциональных узлов приведены ниже. За <span class="math inline">\(n\)</span> будем принимать число строк в итоговой таблице данного узла.</p>
<section id="sec-lab-extra-genetic-materialized-view-query-cost-join" class="level3" data-number="33.6.1"><h3 data-number="33.6.1" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-query-cost-join">
<span class="header-section-number">33.6.1</span> JOIN</h3>
<p>Для JOIN применяется алгоритм хеш-соединения, поэтому стоимость операции оценивается как</p>
<p><span class="math display">\[
n \log{n}
\]</span></p>
</section><section id="sec-lab-extra-genetic-materialized-view-query-cost-where" class="level3" data-number="33.6.2"><h3 data-number="33.6.2" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-query-cost-where">
<span class="header-section-number">33.6.2</span> WHERE</h3>
<p>Условие применяется последовательно к каждой строке для отбора, поэтому стоимость вычисления пропорциональна количеству условий <span class="math inline">\(k\)</span> и числу строк <span class="math inline">\(n\)</span></p>
<p><span class="math display">\[
n \cdot k
\]</span></p>
<p>Аргументы операции WHERE могут зависеть от подзапросов, поэтому к стоимости вычисления добавляется ещё и стоимость вычисления подзапросов.</p>
</section><section id="sec-lab-extra-genetic-materialized-view-query-cost-select" class="level3" data-number="33.6.3"><h3 data-number="33.6.3" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-query-cost-select">
<span class="header-section-number">33.6.3</span> SELECT</h3>
<p>Операция SELECT имеет стоимость <span class="math inline">\(\log{n}\)</span> от числа строк <span class="math inline">\(n\)</span>.</p>
</section><section id="sec-lab-extra-genetic-materialized-view-query-cost-aggregate" class="level3" data-number="33.6.4"><h3 data-number="33.6.4" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-query-cost-aggregate">
<span class="header-section-number">33.6.4</span> AGGREGATE</h3>
<p>В примере рассматриваются следующие функции агрегации</p>
<table class="caption-top table">
<thead><tr class="header">
<th>Функция</th>
<th>Стоимость</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>IDENTITY</td>
<td><span class="math inline">\(0\)</span></td>
</tr>
<tr class="even">
<td>COUNT</td>
<td><span class="math inline">\(1\)</span></td>
</tr>
<tr class="odd">
<td>SUM</td>
<td><span class="math inline">\(n\)</span></td>
</tr>
<tr class="even">
<td>MAX</td>
<td><span class="math inline">\(n\)</span></td>
</tr>
<tr class="odd">
<td>AVG</td>
<td><span class="math inline">\(n\)</span></td>
</tr>
<tr class="even">
<td>MIN</td>
<td><span class="math inline">\(n\)</span></td>
</tr>
<tr class="odd">
<td>DISTINCT</td>
<td><span class="math inline">\(n \log{n}\)</span></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Совет
</div>
</div>
<div class="callout-body-container callout-body">
<p>Библиотека <code>igraph</code> предоставляет гибкие и эффективные функции выбора подграфов, листьев и вершин по условию <a href="#sec-lab-extra-genetic-materialized-view-igraph-query" class="quarto-xref"><span>Глава 33.10</span></a>.</p>
</div>
</div>
</section></section><section id="sec-lab-extra-genetic-materialized-view-objective" class="level2" data-number="33.7"><h2 data-number="33.7" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-objective">
<span class="header-section-number">33.7</span> Целевая функция</h2>
<p>Теперь мы можем рассчитать затраты для различных стратегий материализации представлений. Предположим, что некоторые промежуточные узлы материализованы. Для каждого запроса стоимость обработки равна произведению частоты выполнения запроса на стоимость доступа к запросу от материализованного узла (или узлов). Стоимость поддержки материализованного представления – это стоимость его построения (в данном случае предполагается, что при каждом обновлении задействованных базовых отношений представление полностью пересчитывается). Общая стоимость – это сумма всех затрат на выполнение запросов и затрат на поддержку представлений. Цель – найти такой набор узлов для материализации, при котором общая стоимость минимальна.</p>
<p>Пусть <span class="math inline">\(М\)</span> – набор материализованных представлений, <span class="math inline">\(C_{q_i}(M)\)</span> – стоимость вычислений <span class="math inline">\(q_i\)</span> из набора материализованных представлений <span class="math inline">\(M\)</span>, а <span class="math inline">\(C_m(V)\)</span> – стоимость обслуживания при материализации <span class="math inline">\(v\)</span>. Тогда общая стоимость обработки запроса <span class="math inline">\(\sum_{q_i\in Q} f_{q_i} C_{q_i}(M)\)</span>, а общая стоимость обслуживания <span class="math inline">\(\sum_{v \in M} C_m(v)\)</span>. Общая стоимость материализованных представлений <span class="math inline">\(M\)</span> определяется формулой:</p>
<p><span class="math display">\[
\sum_{q_i \in Q} C_{q_i} f_{q_i}(M)  + \sum_{v \in M} f_u C_m(v)
\]</span></p>
<p>Для заданного глобального плана обработки минимизировать указанную общую стоимость.</p>
</section><section id="sec-lab-extra-genetic-materialized-view-global-plan" class="level2" data-number="33.8"><h2 data-number="33.8" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-global-plan">
<span class="header-section-number">33.8</span> Построение глобального плана запросов</h2>
<p>Глобальный план запросов строился из следующих предположений:</p>
<ul>
<li>Все узлы, которые имеют одинаковый главный аргумент <code>val</code> и пересекающиеся аргументы <code>args</code>
</li>
<li>Сначала создаются (обрабатываются) узлы, имеющие наибольшее количество общих аргументов</li>
<li>Затем узлы, которые имеют меньше общих аргументов, но больше улов используют эти аргументы совместно</li>
<li>Процесс повторяется до тех пор, пока таких узлов не останется</li>
</ul>
<p>В итоге получается один из возможных глобальных планов</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>IGRAPH da14b4a DN-- 146 220 -- 
+ attr: name (v/c), fun (v/c), id (v/c), label (e/c)
+ edges from da14b4a (vertex names):
[1] price_change.price                                    -&gt;SELECT(price_change,price_change.price)               
[2] price_change                                          -&gt;SELECT(price_change,price_change.price)               
[3] AVG                                                   -&gt;AGGREGATE(SELECT(price_change,price_change.price),AVG)
[4] SELECT(price_change,price_change.price)               -&gt;AGGREGATE(SELECT(price_change,price_change.price),AVG)
[5] AGGREGATE(SELECT(price_change,price_change.price),AVG)-&gt;average_price                                         
+ ... omitted several edges</code></pre>
</div>
</div>
<p>Для наглядной визуализации определим цвета базовых узлов</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">fun</th>
<th style="text-align: left;">color</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">table</td>
<td style="text-align: left;">blue</td>
</tr>
<tr class="even">
<td style="text-align: left;">condition</td>
<td style="text-align: left;">green</td>
</tr>
<tr class="odd">
<td style="text-align: left;">column</td>
<td style="text-align: left;">magenta</td>
</tr>
<tr class="even">
<td style="text-align: left;">aggregate</td>
<td style="text-align: left;">orange</td>
</tr>
<tr class="odd">
<td style="text-align: left;">query</td>
<td style="text-align: left;">yellow</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>и отобразим на графе</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="main_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Красным отмечены промежуточные совместно используемые узлы</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="main_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Граф определяется в следующих файлах</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>⤓ <a href="plan.graphml">plan.graphml</a></p>
<p>⤓ <a href="vertex.csv">vertex.csv</a></p>
<p>⤓ <a href="edges.csv">edges.csv</a></p>
</div>
</div>
</div>
</section><section id="sec-lab-extra-genetic-materialized-view-genetic-alghorithm" class="level2" data-number="33.9"><h2 data-number="33.9" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-genetic-alghorithm">
<span class="header-section-number">33.9</span> Решение генетическим алгоритмом</h2>
<p>Таким образом получается, что целевая функция зависит от набора материализуемых представлений (промежуточных узлов). Её структуру можно представить с помощью битовой строки, где позиции (индекс) это номер представления, а значение – решение о его материализации.</p>
<p><a href="https://loginom.ru/blog/ga-math" class="uri">https://loginom.ru/blog/ga-math</a></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Совет
</div>
</div>
<div class="callout-body-container callout-body">
<p>Задача оптимизации битовых строк является широко распространённой. Рекомендуется использовать готовый пакет, например <a href="https://github.com/luca-scr/GA/reference/ga.html"><code>GA::ga()</code></a>.</p>
</div>
</div>
</section><section id="sec-lab-extra-genetic-materialized-view-igraph-query" class="level2" data-number="33.10"><h2 data-number="33.10" class="anchored" data-anchor-id="sec-lab-extra-genetic-materialized-view-igraph-query">
<span class="header-section-number">33.10</span> Запросы к графу</h2>
<section id="выбор-поддерева" class="level3" data-number="33.10.1"><h3 data-number="33.10.1" class="anchored" data-anchor-id="выбор-поддерева">
<span class="header-section-number">33.10.1</span> Выбор поддерева</h3>
<p><a href="https://r.igraph.org/reference/unfold_tree.html"><code>igraph::unfold_tree()</code></a> и <a href="https://r.igraph.org/reference/subgraph.html"><code>igraph::subgraph()</code></a>.</p>
</section><section id="выбор-вершин" class="level3" data-number="33.10.2"><h3 data-number="33.10.2" class="anchored" data-anchor-id="выбор-вершин">
<span class="header-section-number">33.10.2</span> Выбор вершин</h3>
<p>Индексация <a href="https://igraph.org/r/html/latest/igraph-vs-indexing.html"><code>igraph::V(g)[]</code></a> позволяет использовать атрибуты вершин в запросе</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">V</span>(g)[fun <span class="sc">==</span> <span class="st">'JOIN'</span>]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Также этот запрос можно комбинировать с логическим вектором</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">V</span>(g)[fun <span class="sc">==</span> <span class="st">'JOIN'</span> <span class="sc">&amp;</span> igraph<span class="sc">::</span><span class="fu">degree</span>(g, <span class="at">mode =</span> <span class="st">'out'</span>)]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section><section id="степень-вершины" class="level3" data-number="33.10.3"><h3 data-number="33.10.3" class="anchored" data-anchor-id="степень-вершины">
<span class="header-section-number">33.10.3</span> Степень вершины</h3>
<p>Чтобы определить количество входящих и выходящих рёбер из вершины полезна функция <a href="https://r.igraph.org/reference/degree.html"><code>igraph::degree()</code></a>.</p>
</section><section id="выбор-рёбер" class="level3" data-number="33.10.4"><h3 data-number="33.10.4" class="anchored" data-anchor-id="выбор-рёбер">
<span class="header-section-number">33.10.4</span> Выбор рёбер</h3>
<p><a href="https://igraph.org/r/html/latest/igraph-es-indexing.html"><code>igraph::E(g)[]</code></a> полезными будут аргументы <code>to</code> и <code>from</code></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">E</span>(g)[<span class="fu">.to</span>(),<span class="fu">from</span>()]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section><section id="получение-вершин-смежных-ребру" class="level3" data-number="33.10.5"><h3 data-number="33.10.5" class="anchored" data-anchor-id="получение-вершин-смежных-ребру">
<span class="header-section-number">33.10.5</span> Получение вершин смежных ребру</h3>
<p><a href="https://r.igraph.org/reference/tail_of.html"><code>igraph::tail_of()</code></a> и <a href="https://r.igraph.org/reference/head_of.html"><code>igraph::head_of()</code></a></p>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Скопировано");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Скопировано");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../../../lab/extra/evolutionary/main.html" class="pagination-link" aria-label="Эволюционная оптимизация. Телекомания">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Эволюционная оптимизация. Телекомания</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../lab/extra/constraint/main.html" class="pagination-link" aria-label="Программирование в ограничениях">
        <span class="nav-page-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Программирование в ограничениях</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/AfonenkoA/Operations-Research/issues/new" class="toc-action"><i class="bi bi-github"></i>Сообщить о проблеме</a></li><li><a href="https://github.com/AfonenkoA/Operations-Research/blob/master/lab/extra/genetic/main.qmd" class="toc-action"><i class="bi empty"></i>Показать код</a></li></ul></div></div></div></footer></body></html>