---
engine: knitr
cache: false
freeze: false
---

# Программирование в ограничениях {#sec-lab-extra-constraint}

## Теория {#sec-lab-extra-constraint-theory}

::: callout-tip
Задачи могут быть сформулированы в условиях "если-то", "или-или" в ручную, или при помощи макросов языка minizinc @sec-minizinc-basic
:::

## Задания {#sec-lab-extra-constraint-task}

:::: {#exr-lab-extra-constraint-cryptarithms}
### Ребус

Сформулировать как задачу целочисленного линейного программирования. Условие соответствия различных букв различным значениям переменных можно задать используя подход [попарных неравенств](https://ampl.com/mo-book/notebooks/03/cryptarithms.html) или макрос [`all_different`](https://docs.minizinc.dev/en/stable/lib-globals-alldifferent.html) языка minizinc.

$$
\begin{array}{ccccc}
&& G & E & T \\
&\times&& B & Y\\
\hline
& B & A & B & E \\
& G & E & T & \\
\hline
B&E&A&R&E
\end{array}
$$

::: {.callout-note appearance="minimal"}
Уровень 4
:::
::::

:::: {#exr-lab-extra-constraint-jindosh-riddle}
### Задача Джиндоша

На званом обеде были леди Уинслоу, доктор Марколла, графиня Конти, мадам Нациу и баронесса Финч.

Женщины сидели в ряд. Все они были одеты в разные цвета. Например, Леди Уинслоу носила причудливое синее пончо; Доктор Марколла левее всех, рядом с гостьей, одетой в белое. Дама, одетая в красное платье, сидела слева от гостьи, одетой в пурпурное. Я помню красное платье, потому что его обладательница пролила на него виски. Путешественница, недавно покинувшая Морли, была одета во всё зелёное. Когда одна гостья хвастливо демонстрировала Портсигар, женщина, сидевшая рядом с ней, заметила: «Мой родной Морли славится такими безделушками».

Тогда Баронесса Финч достала из сумочки свою фамильную ценность — Кулон с птицей. Дама, до того рассказывавшая, как красив в это время года её родной край, Фрейпорт, с усмешкой заметила, что её Перстень — куда большая редкость. Другая дама начала демонстративно рассматривать свою реликвию — Бриллиант; сидевшая рядом с ней гостья (помнится, её родина — Дануолл) чуть не выбила коктейль из рук своей соседки. Внезапно Графиня Конти, пившая исключительно абсент, предложила тост. Дама, которой предстояло навестить Серконос и которая весь вечер налегала на сидр, попыталась запрыгнуть на стол, но повалилась на гостью, сидевшую посередине, и та пролила ром. Затем Мадам Нациу завладела всеобщим вниманием, рассказав про Бейлтон времён своей юности.

Наутро под столом валялись 4 фамильные драгоценности: Портсигар, Орден, Перстень и Бриллиант.

Но кому принадлежит каждая из них?

::: {.callout-note appearance="minimal"}
Уровень 4
:::
::::

::::: {#exr-lab-extra-constraint-radio-day}
### День радиофизика

После празднования дня радиофизика студенты планируют продолжение банкета, нарушающее правила проживания в общежитии. План общежития состоящего из нескольких блоков и коридоров соединённых открытыми дверями показан на рисунке. Член СБО, находящийся у двери может наблюдать за двумя смежными комнатами. Администрация общежития заинтересована, чтобы каждую комнату контролировал член СБО, при этом их число должно быть минимальным. Сформулируйте соответствующую задачу ЛП и решите её.

![](dormitory.svg){fig-align="center"}

::: {layout-ncol="2"}

| №   | Название комнаты |
|-----|------------------|
| 1   | Балкон           |
| 2   | Жилая комната    |
| 3   | Гостевая         |
| 4   | Жилая комната    |
| 5   | Прихожая         |
| 6   | Жилая комната    |
| 7   | Жилая комната    |
| 8   | Прихожая         |
| 9   | Коридор          |
| 10  | Прихожая         |
| 11  | Гардероб         |
| 12  | Кладовая         |
| 13  | Жилая комната    |
| 14  | Жилая комната    |
| 15  | Жилая комната    |
| 16  | Кухня            |
| 17  | Прихожая         |
| 18  | Жилая комната    |
| 19  | Жилая комната    |

| №   | Наблюдаемые комнаты |
|-----|---------------------|
| a   | 1, 3                |
| b   | 3, 4                |
| c   | 2, 5                |
| d   | 3, 5                |
| e   | 4, 5                |
| f   | 6, 7                |
| g   | 6, 8                |
| h   | 7, 8                |
| i   | 5, 9                |
| j   | 7, 8, 9             |
| k   | 9, 10, 13           |
| l   | 9, 17               |
| m   | 10, 11, 12          |
| n   | 10, 11, 12          |
| o   | 10, 13              |
| p   | 11, 14              |
| q   | 14, 15              |
| r   | 16, 17              |
| s   | 16, 18              |
| t   | 17, 18              |
| u   | 17, 19              |
:::

::: {.callout-note appearance="minimal"}
Уровень 4
:::

<!--Таха 9.22 c 371-->
:::::

:::::::: {#exr-lab-extra-constraint-connection}
### Хоть бы BBB запустился

Оператор НИКС совместно с ЦИТ БГУ планирует построить новые маршрутизаторы, для обеспечения быстрой и надёжной сети в подразделениях БГУ. Схема подразделений приведена на рисунке, а их описание в таблице. Столбец `cluster` отвечает за то, к какой зоне покрытия относятся подразделения.

:::: {.content-visible when-format="html"}
::: {.callout appearance="minimal"}
⤓ [BSU.csv](BSU.csv)
:::
::::

:::: {.content-visible unless-format="html"}
::: {.callout appearance="minimal"}
`\faFile*[regular].`{=latex} [BSU.csv](lab/extra/constraint/BSU.csv)
:::
::::

```{r}
#| echo: false

tbl <- readr::read_csv('BSU.csv', 
                       col_types = c('d','d','c','i','i'))
knitr::kable(head(tbl))
```

Для обслуживания сети можно установить следующие магистральные маршрутизаторы. Стоимость указана в (тыс. долл.)

| Маршрутизатор | Зона покрытия  | Стоимость |
|:-------------:|:--------------:|:---------:|
|       1       |  1, 3, 7, 10   |   4.50    |
|       2       |    3, 4, 10    |   3.10    |
|       3       |    1, 2, 11    |   2.30    |
|       4       | 1, 2, 3, 4, 11 |   7.20    |
|       5       |      6, 8      |   1.80    |
|       6       | 5, 6, 8, 9, 12 |   6.90    |
|       7       |  1, 2, 7, 11   |   4.70    |
|       8       |    5, 9, 12    |   3.40    |

Задача --- обеспечить все корпуса подключением к сети, минимизировав стоимость установки маршрутизаторов.

```{r}
#| echo: false
#| fig-align: center

if (!interactive() && !knitr::is_html_output())
{
  knitr::include_graphics('map.png')
} else
{
  leaflet::leaflet() |> 
  leaflet::addTiles() |> 
  leaflet::addMarkers(tbl$lon,
             tbl$lat, 
             label = tbl$cluster,
             labelOptions = leaflet::labelOptions(noHide = TRUE)) |>
  lshow()
}
```

::: {.callout-note appearance="minimal"}
Уровень 4
:::
::::::::
